<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flashcards</title>
    <style>
        :root {
            --bg: #f5f5f7;
            --surface: #ffffff;
            --text: #1d1d1f;
            --text-secondary: #6e6e73;
            --border: #d2d2d7;
            --primary: #0071e3;
            --primary-hover: #0077ed;
            --success: #34c759;
            --warning: #ff9500;
            --error: #ff3b30;
            --radius: 12px;
            --shadow: 0 4px 16px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 3rem 2rem;
            line-height: 1.5;
        }

        .container {
            max-width: 640px;
            margin: 0 auto;
        }

        /* Study Panel */
        .study-panel {
            background: var(--surface);
            border-radius: 24px;
            padding: 4rem 3rem;
            min-height: 420px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .welcome-screen { text-align: center; }
        .welcome-screen h1 { 
            font-size: 2.5rem; 
            font-weight: 700;
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }
        .welcome-screen p { 
            color: var(--text-secondary); 
            font-size: 1.125rem;
            margin-bottom: 2.5rem;
        }

        .sentence {
            font-size: 1.75rem;
            line-height: 1.6;
            text-align: center;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .hint {
            color: var(--text-secondary);
            font-size: 1.125rem;
            margin-bottom: 2.5rem;
        }

        input[type="text"] {
            border: 2px solid var(--border);
            background: var(--bg);
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            width: 320px;
            font-size: 1.25rem;
            text-align: center;
            outline: none;
            transition: all 0.2s ease;
        }

        input[type="text"]:focus { 
            border-color: var(--primary); 
            background: var(--surface);
            box-shadow: 0 0 0 4px rgba(0,113,227,0.1);
        }

        .msg { 
            margin-top: 1.5rem; 
            min-height: 1.5rem;
            font-weight: 500;
        }
        .msg.ok { color: var(--success); }
        .msg.no { color: var(--error); }

        /* Buttons */
        button {
            font-family: inherit;
            font-size: 1rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            border: none;
            background: var(--bg);
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        button:hover { transform: translateY(-1px); }
        button:active { transform: translateY(0); }

        .btn-primary { 
            background: var(--primary); 
            color: #fff;
            padding: 1rem 2.5rem;
            font-size: 1.125rem;
            box-shadow: 0 4px 12px rgba(0,113,227,0.3);
        }
        .btn-primary:hover { 
            background: var(--primary-hover); 
            box-shadow: 0 6px 16px rgba(0,113,227,0.4);
        }
        .btn-primary:disabled { 
            background: #ccc; 
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary { 
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 1rem 2.5rem;
            font-size: 1.125rem;
        }
        .btn-secondary:hover { 
            background: var(--bg);
            border-color: var(--text-secondary);
        }

        .btn-danger { 
            color: var(--error); 
            background: rgba(255,59,48,0.08);
        }
        .btn-danger:hover { background: rgba(255,59,48,0.12); }

        .btn-add { 
            background: var(--primary); 
            color: #fff;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        .btn-add:hover { background: var(--primary-hover); }

        /* Panel Toggle */
        .panel-toggle {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--surface);
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1200;
        }

        .panel-toggle:hover { 
            opacity: 1; 
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--warning);
            color: #fff;
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
            font-weight: 700;
            min-width: 18px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Right Panel */
        .right-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background: var(--surface);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        .right-panel.open { right: 0; }

        .panel-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.3);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
            backdrop-filter: blur(4px);
        }

        .panel-overlay.show { opacity: 1; visibility: visible; }

        .panel-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .panel-header h2 { 
            font-size: 1.25rem; 
            font-weight: 600;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.25rem;
        }

        /* Cards */
        .card { 
            background: var(--bg); 
            border-radius: var(--radius); 
            padding: 1.25rem; 
            margin-bottom: 1rem;
        }

        .card h3 { 
            font-size: 0.75rem; 
            text-transform: uppercase; 
            letter-spacing: 0.08em;
            color: var(--text-secondary); 
            margin-bottom: 1rem;
            font-weight: 600;
        }

        /* Stats */
        .stats { display: flex; gap: 0.75rem; }
        
        .stat { 
            flex: 1; 
            text-align: center; 
            padding: 1rem; 
            background: var(--surface); 
            border-radius: var(--radius);
            transition: transform 0.2s ease;
        }
        
        .stat:hover { transform: translateY(-2px); }
        
        .stat .num { 
            font-size: 1.75rem; 
            font-weight: 700; 
            display: block;
            line-height: 1;
            margin-bottom: 0.25rem;
        }
        
        .stat .label { 
            font-size: 0.75rem; 
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .stat.due { background: #fff4e6; }
        .stat.due .num { color: var(--warning); }
        .stat.mastered { background: #e8f5e9; }
        .stat.mastered .num { color: var(--success); }

        /* Data Actions */
        .data-actions { display: flex; gap: 0.5rem; }
        .data-actions button { flex: 1; font-size: 0.875rem; padding: 0.625rem; }

        /* Sort & List */
        .sort-select { 
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border); 
            border-radius: 8px; 
            padding: 0.5rem 0.75rem; 
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            outline: none;
        }

        .sort-select:focus { border-color: var(--primary); }

        .word-list { max-height: 320px; overflow-y: auto; }

        .word-item { 
            display: flex; 
            align-items: center; 
            padding: 0.75rem; 
            border-radius: 8px; 
            gap: 0.75rem; 
            background: var(--surface);
            margin-bottom: 0.5rem;
            transition: all 0.15s ease;
        }
        
        .word-item:hover { 
            background: var(--bg);
            transform: translateX(2px);
        }

        .word-status { 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
            flex-shrink: 0;
        }
        
        .word-status.due { background: var(--warning); }
        .word-status.ok { background: var(--success); }
        .word-status.new { background: var(--text-secondary); }

        .word-info { flex: 1; }
        
        .word-name { 
            font-weight: 600; 
            font-size: 1rem;
            margin-bottom: 0.125rem;
        }
        
        .word-meta { 
            font-size: 0.8125rem; 
            color: var(--text-secondary);
        }

        .word-actions { display: flex; gap: 0.25rem; }
        
        .word-actions button { 
            padding: 0.4rem 0.6rem; 
            font-size: 0.875rem; 
            background: transparent;
            border-radius: 6px;
        }
        
        .word-actions button:hover { background: var(--border); }

        .empty { 
            text-align: center; 
            padding: 3rem 2rem; 
            color: var(--text-secondary);
            font-size: 0.9375rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1100;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.show { display: flex; }

        .modal { 
            background: var(--surface); 
            border-radius: 20px; 
            padding: 2rem; 
            width: 420px;
            box-shadow: var(--shadow-lg);
            animation: modal-in 0.3s ease;
        }

        @keyframes modal-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal h3 { 
            font-size: 1.5rem; 
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .form-group { margin-bottom: 1.25rem; }
        
        .form-group label { 
            display: block; 
            font-size: 0.875rem; 
            font-weight: 500;
            color: var(--text-secondary); 
            margin-bottom: 0.5rem; 
        }
        
        .form-group input, 
        .form-group textarea { 
            width: 100%; 
            padding: 0.875rem 1rem; 
            border: 1px solid var(--border); 
            border-radius: var(--radius); 
            font: inherit;
            font-size: 1rem;
            transition: all 0.2s ease;
        }
        
        .form-group textarea { 
            height: 80px; 
            resize: none; 
        }
        
        .form-group input:focus, 
        .form-group textarea:focus { 
            outline: none; 
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0,113,227,0.1);
        }

        .modal-actions { 
            display: flex; 
            gap: 0.75rem; 
            justify-content: flex-end; 
            margin-top: 1.5rem; 
        }

        .error { 
            color: var(--error); 
            font-size: 0.875rem; 
            margin-top: 0.5rem;
            display: none;
            font-weight: 500;
        }
        
        .error.show { display: block; }

        /* Animations */
        .shake { animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97); }
        
        @keyframes shake {
            10%, 90% { transform: translateX(-1px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-4px); }
            40%, 60% { transform: translateX(4px); }
        }

        input[type="file"] { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <main class="study-panel" id="studyPanel">
            <div class="welcome-screen" id="welcomeScreen">
                <h1>üìö Flashcards</h1>
                <p><span id="dueCount">0</span> cards due for review</p>
                <div style="display: flex; gap: 0.75rem; justify-content: center;">
                    <button class="btn-primary" id="startBtn" onclick="startStudy()" disabled>No Cards Due</button>
                    <button class="btn-secondary" id="practiceBtn" onclick="startPractice()" style="display: none;">Practice All</button>
                </div>
            </div>

            <div id="studyInterface" style="display: none; width: 100%; text-align: center;">
                <p class="sentence" id="sentence"></p>
                <p class="hint" id="hint"></p>
                <input type="text" id="answer" autocomplete="off" placeholder="Type the word...">
                <p class="msg" id="msg"></p>
            </div>

            <div id="doneScreen" style="display: none; text-align: center;">
                <h2 style="color: var(--success); margin-bottom: 1rem;">üéâ All Caught Up!</h2>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">No more cards due for review.</p>
                <button onclick="showWelcome()">Back to Home</button>
            </div>
        </main>
    </div>

    <button class="panel-toggle" onclick="togglePanel()" title="Dashboard">‚öôÔ∏è<span class="badge" id="dueBadge" style="display: none;">0</span></button>

    <div class="panel-overlay" id="panelOverlay" onclick="closePanel()"></div>
    <aside class="right-panel" id="rightPanel">
        <div class="panel-header"><h2>üìä Dashboard</h2></div>
        <div class="panel-content">
            <div class="card">
                <h3>Statistics</h3>
                <div class="stats">
                    <div class="stat due"><span class="num" id="statDue">0</span><span class="label">Due</span></div>
                    <div class="stat"><span class="num" id="statLearning">0</span><span class="label">Learning</span></div>
                    <div class="stat mastered"><span class="num" id="statMastered">0</span><span class="label">Mastered</span></div>
                </div>
            </div>

            <div class="card">
                <h3>Data</h3>
                <div class="data-actions">
                    <button onclick="exportData()">üì§ Export</button>
                    <button onclick="importInput.click()">üì• Import</button>
                    <button class="btn-danger" onclick="clearData()">üóëÔ∏è Clear</button>
                </div>
                <input type="file" id="importInput" accept=".json" onchange="importData(this)">
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                    <h3 style="margin: 0;">Cards (<span id="totalCards">0</span>)</h3>
                    <button class="btn-add" onclick="openModal()">+ Add</button>
                </div>
                <select class="sort-select" id="sortSelect" onchange="renderList()">
                    <option value="due">Sort: Due First</option>
                    <option value="name-asc">Name: A ‚Üí Z</option>
                    <option value="name-desc">Name: Z ‚Üí A</option>
                    <option value="level-asc">Level: Low ‚Üí High</option>
                    <option value="level-desc">Level: High ‚Üí Low</option>
                </select>
                <div class="word-list" id="wordList"></div>
            </div>
        </div>
    </aside>

    <div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
        <div class="modal">
            <h3 id="modalTitle">Add Card</h3>
            <div class="form-group">
                <label>Word</label>
                <input type="text" id="mWord" placeholder="e.g., elephant">
            </div>
            <div class="form-group">
                <label>Definition</label>
                <input type="text" id="mDef" placeholder="e.g., a large animal with a trunk">
            </div>
            <div class="form-group">
                <label>Sentence (must include the word)</label>
                <textarea id="mSent" placeholder="e.g., The elephant sprayed water with its trunk."></textarea>
                <p class="error" id="mError">Sentence must include the word</p>
            </div>
            <div class="modal-actions">
                <button onclick="closeModal()">Cancel</button>
                <button class="btn-primary" onclick="saveCard()">Save</button>
            </div>
        </div>
    </div>

    <script>
        let cards = JSON.parse(localStorage.getItem('flashcards') || '[]');
        let currentCard = null, editingIndex = -1, waitingForNext = false, practiceMode = false;

        const intervals = [1, 10, 60, 180, 360, 720, 1440];

        if (cards.length === 0) {
            cards = [
                {w: 'apple', d: 'a round red or green fruit', s: 'She took a bite of the crisp apple.', level: 0, due: 0},
                {w: 'ocean', d: 'a very large sea', s: 'The ocean waves crashed against the shore.', level: 0, due: 0},
                {w: 'brilliant', d: 'very bright or intelligent', s: 'He had a brilliant idea for the project.', level: 0, due: 0}
            ];
            saveCards();
        }

        function saveCards() { localStorage.setItem('flashcards', JSON.stringify(cards)); }

        function getDueCards() { return cards.filter(c => (c.due || 0) <= Date.now()); }

        function scheduleCard(card, correct) {
            if (!card.level) card.level = 0;
            card.level = correct ? card.level + 1 : Math.max(0, card.level - 1);
            card.due = Date.now() + (intervals[Math.min(card.level, intervals.length - 1)] || 1) * 60000;
        }

        function formatTime(mins) {
            return mins < 60 ? `${mins}m` : mins < 1440 ? `${Math.round(mins/60)}h` : `${Math.round(mins/1440)}d`;
        }

        function togglePanel() {
            document.getElementById('rightPanel').classList.toggle('open');
            document.getElementById('panelOverlay').classList.toggle('show');
        }

        function closePanel() {
            document.getElementById('rightPanel').classList.remove('open');
            document.getElementById('panelOverlay').classList.remove('show');
        }

        function updateStats() {
            const due = getDueCards().length;
            const mastered = cards.filter(c => (c.level || 0) >= 4).length;
            const learning = cards.length - mastered;

            document.getElementById('dueCount').textContent = due;
            document.getElementById('statDue').textContent = due;
            document.getElementById('statLearning').textContent = learning;
            document.getElementById('statMastered').textContent = mastered;
            document.getElementById('totalCards').textContent = cards.length;
            
            const badge = document.getElementById('dueBadge');
            badge.textContent = due;
            badge.style.display = due > 0 ? 'block' : 'none';

            const startBtn = document.getElementById('startBtn');
            const practiceBtn = document.getElementById('practiceBtn');
            startBtn.disabled = due === 0;
            startBtn.textContent = due === 0 ? 'No Cards Due' : 'Start Studying';
            practiceBtn.style.display = (due === 0 && cards.length > 0) ? 'inline-block' : 'none';
        }

        function renderList() {
            const list = document.getElementById('wordList');
            if (cards.length === 0) { list.innerHTML = '<div class="empty">No cards yet</div>'; return; }

            const sortType = document.getElementById('sortSelect').value;
            const sorted = [...cards].map((c, i) => ({...c, idx: i})).sort((a, b) => {
                const aDue = (a.due || 0) <= Date.now(), bDue = (b.due || 0) <= Date.now();
                switch(sortType) {
                    case 'due': return bDue - aDue || (b.level || 0) - (a.level || 0);
                    case 'name-asc': return a.w.localeCompare(b.w);
                    case 'name-desc': return b.w.localeCompare(a.w);
                    case 'level-asc': return (a.level || 0) - (b.level || 0);
                    case 'level-desc': return (b.level || 0) - (a.level || 0);
                }
            });

            list.innerHTML = sorted.map(c => {
                const isDue = (c.due || 0) <= Date.now();
                const level = c.level || 0;
                const status = isDue ? 'due' : level >= 4 ? 'ok' : 'new';
                const next = c.due ? formatTime(Math.max(0, Math.ceil((c.due - Date.now()) / 60000))) : 'now';
                const stage = level === 0 ? 'New' : level < 4 ? `Learning ${level}` : 'Mastered';
                return `<div class="word-item"><div class="word-status ${status}"></div><div class="word-info"><div class="word-name">${c.w}</div><div class="word-meta">${stage} ¬∑ ${isDue ? 'Due now' : 'Next: ' + next}</div></div><div class="word-actions"><button onclick="editCard(${c.idx})" title="Edit">‚úé</button><button class="btn-danger" onclick="deleteCard(${c.idx})" title="Delete">üóë</button></div></div>`;
            }).join('');
        }

        function startStudy() { practiceMode = false; showCard(); }
        function startPractice() { practiceMode = true; showCard(); }

        function showCard() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('doneScreen').style.display = 'none';
            document.getElementById('studyInterface').style.display = '';
            nextCard();
        }

        function showWelcome() {
            practiceMode = false;
            document.getElementById('studyInterface').style.display = 'none';
            document.getElementById('doneScreen').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = '';
            updateStats(); renderList();
        }

        function nextCard() {
            const pool = practiceMode ? cards : getDueCards();
            if (pool.length === 0) {
                document.getElementById('studyInterface').style.display = 'none';
                document.getElementById('doneScreen').style.display = '';
                return;
            }
            waitingForNext = false;
            currentCard = pool[Math.floor(Math.random() * pool.length)];
            const regex = new RegExp(currentCard.w.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
            document.getElementById('sentence').textContent = currentCard.s.replace(regex, '___');
            document.getElementById('hint').textContent = `${currentCard.d} (${currentCard.w[0]}...)`;
            document.getElementById('answer').value = '';
            document.getElementById('answer').readOnly = false;
            document.getElementById('answer').style.background = '';
            document.getElementById('msg').textContent = '';
            document.getElementById('answer').focus();
        }

        document.getElementById('answer').onkeydown = function(e) {
            if (e.key !== 'Enter' || !currentCard) return;
            if (waitingForNext) { nextCard(); return; }

            const input = this.value.trim().toLowerCase();
            const correct = currentCard.w.toLowerCase();
            const regex = new RegExp(`(${currentCard.w.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');

            if (input === correct) {
                scheduleCard(currentCard, true);
                saveCards();
                document.getElementById('sentence').innerHTML = currentCard.s.replace(regex, '<span class="ok">$1</span>');
                document.getElementById('msg').innerHTML = '<span style="color: var(--text-secondary);">Press Enter to continue</span>';
                this.readOnly = true;
                this.style.background = '#e8e8ed';
                waitingForNext = true;
            } else {
                scheduleCard(currentCard, false);
                saveCards();
                document.getElementById('sentence').innerHTML = currentCard.s.replace(regex, '<span class="no">$1</span>');
                document.getElementById('msg').innerHTML = '<span style="color: var(--text-secondary);">Press Enter to try again</span>';
                this.value = '';
                this.readOnly = true;
                this.style.background = '#ffeceb';
                this.classList.add('shake');
                setTimeout(() => this.classList.remove('shake'), 500);
                waitingForNext = true;
            }
            updateStats(); renderList();
        };

        function openModal() {
            editingIndex = -1;
            document.getElementById('modalTitle').textContent = 'Add Card';
            document.getElementById('mWord').value = '';
            document.getElementById('mDef').value = '';
            document.getElementById('mSent').value = '';
            document.getElementById('mError').classList.remove('show');
            document.getElementById('modal').classList.add('show');
            document.getElementById('mWord').focus();
        }

        function editCard(index) {
            editingIndex = index;
            const c = cards[index];
            document.getElementById('modalTitle').textContent = 'Edit Card';
            document.getElementById('mWord').value = c.w;
            document.getElementById('mDef').value = c.d;
            document.getElementById('mSent').value = c.s;
            document.getElementById('mError').classList.remove('show');
            document.getElementById('modal').classList.add('show');
        }

        function closeModal() { document.getElementById('modal').classList.remove('show'); }

        function saveCard() {
            const w = document.getElementById('mWord').value.trim();
            const d = document.getElementById('mDef').value.trim();
            const s = document.getElementById('mSent').value.trim();

            if (!w || !d || !s) { alert('Please fill in all fields'); return; }
            if (!s.toLowerCase().includes(w.toLowerCase())) { document.getElementById('mError').classList.add('show'); return; }

            if (editingIndex >= 0) {
                cards[editingIndex] = { ...cards[editingIndex], w, d, s };
            } else {
                cards.push({ w, d, s, level: 0, due: 0 });
            }
            saveCards();
            closeModal();
            updateStats(); renderList();
        }

        function deleteCard(index) {
            if (!confirm(`Delete "${cards[index].w}"?`)) return;
            cards.splice(index, 1);
            saveCards();
            updateStats(); renderList();
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(cards, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `flashcards-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            file.text().then(text => {
                try {
                    const data = JSON.parse(text);
                    if (!Array.isArray(data)) throw new Error('Invalid format');
                    const valid = data.filter(c => c.w && c.d && c.s);
                    if (confirm(`Import ${valid.length} cards? This will merge with existing ${cards.length} cards.`)) {
                        cards = cards.concat(valid);
                        saveCards();
                        updateStats(); renderList();
                    }
                } catch (e) { alert('Error: ' + e.message); }
                input.value = '';
            });
        }

        function clearData() {
            if (!confirm(`Delete all ${cards.length} cards? This cannot be undone.`)) return;
            cards = [];
            saveCards();
            updateStats(); renderList();
        }

        document.onkeydown = e => { if (e.key === 'Escape') { closeModal(); closePanel(); } };

        updateStats(); renderList();
    </script>
</body>
</html>
